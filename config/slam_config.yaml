# Visual-Inertial SLAM Configuration
# Author: Al Numan

slam:
  # ============================================================
  # Feature Detection
  # ============================================================
  feature:
    type: "ORB"
    num_features: 2000
    scale_factor: 1.2
    num_levels: 8
    ini_th_fast: 20
    min_th_fast: 7

    # Grid distribution
    grid_rows: 30
    grid_cols: 40

  # ============================================================
  # Feature Matching
  # ============================================================
  matching:
    ratio_threshold: 0.75
    hamming_threshold: 50
    check_orientation: true
    orientation_threshold: 30.0  # degrees

  # ============================================================
  # Tracking
  # ============================================================
  tracking:
    min_inliers: 15
    min_matches: 20
    reproj_threshold: 2.0

    # Keyframe creation
    keyframe_interval: 5
    keyframe_translation: 0.1    # meters
    keyframe_rotation: 5.0       # degrees
    min_tracked_ratio: 0.5

    # Motion model
    use_motion_model: true

  # ============================================================
  # IMU Parameters
  # ============================================================
  imu:
    enabled: true
    rate: 200.0                  # Hz

    # Noise (adjust for your IMU)
    gyro_noise: 0.004            # rad/s/sqrt(Hz)
    accel_noise: 0.04            # m/s^2/sqrt(Hz)
    gyro_bias_noise: 0.00004     # rad/s^2/sqrt(Hz)
    accel_bias_noise: 0.004      # m/s^3/sqrt(Hz)

    # Initial biases (can be calibrated)
    init_gyro_bias: [0.0, 0.0, 0.0]
    init_accel_bias: [0.0, 0.0, 0.0]

  # ============================================================
  # Local Mapping
  # ============================================================
  mapping:
    # Triangulation
    min_parallax: 1.0            # degrees
    max_reproj_error: 2.0        # pixels

    # Local bundle adjustment
    local_ba_keyframes: 7
    local_ba_iterations: 10

    # Culling
    culling_redundancy: 0.9
    min_observations: 3

  # ============================================================
  # Loop Closure
  # ============================================================
  loop_closure:
    enabled: true
    vocabulary_path: "config/ORBvoc.txt"

    # Detection
    min_score: 0.05
    min_consistency: 3
    min_inliers: 25

    # Verification
    max_reproj_error: 3.0
    ransac_iterations: 300

    # Optimization
    enable_pose_graph: true
    pose_graph_iterations: 20

  # ============================================================
  # Bundle Adjustment
  # ============================================================
  optimization:
    max_iterations: 10
    function_tolerance: 1.0e-6
    parameter_tolerance: 1.0e-8
    use_huber: true
    huber_delta: 1.0

  # ============================================================
  # Dense Mapping (Optional)
  # ============================================================
  dense_mapping:
    enabled: false
    voxel_size: 0.05             # meters
    depth_min: 0.1               # meters
    depth_max: 10.0              # meters
    update_rate: 1.0             # Hz

  # ============================================================
  # Visualization
  # ============================================================
  visualization:
    publish_pointcloud: true
    publish_trajectory: true
    publish_keyframes: true
    map_publish_rate: 2.0        # Hz

  # ============================================================
  # Output
  # ============================================================
  output:
    save_trajectory: true
    trajectory_format: "tum"     # tum, kitti, euroc
    save_map: true
    map_path: "map.bin"
